<!DOCTYPE html>
<html >
<head>

    <!--[if lt IE 9]>
        <style>body {display: none; background: none !important} </style>
        <meta http-equiv="Refresh" Content="0; url=//outdatedbrowser.com/" />
    <![endif]-->

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="format-detection" content="telephone=no" />
<meta name="author" content="Shirly" />


    
    


<meta property="og:type" content="website">
<meta property="og:title" content="Shirly">
<meta property="og:url" content="https://yqzh186.github.io/page/12/index.html">
<meta property="og:site_name" content="Shirly">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Shirly">

<link rel="apple-touch-icon" href= "/apple-touch-icon.png">


    <link rel="alternate" href="/atom.xml" title="Shirly" type="application/atom+xml">



    <link rel="shortcut icon" href="/favicon.ico">



    <link href="//cdn.bootcss.com/animate.css/3.5.1/animate.min.css" rel="stylesheet">



    <link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">



    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-minimal.css" rel="stylesheet">


<link rel="stylesheet" href="/css/style.css">


    <style> .article { opacity: 0;} </style>


<link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">


<title>Shirly</title>

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>

<script>
    var yiliaConfig = {
        fancybox: true,
        animate: true,
        isHome: true,
        isPost: false,
        isArchive: false,
        isTag: false,
        isCategory: false,
        fancybox_js: "//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js",
        scrollreveal: "//cdn.bootcss.com/scrollReveal.js/3.1.4/scrollreveal.min.js",
        search: true
    }
</script>


    <script> yiliaConfig.jquery_ui = [false]; </script>



    <script> yiliaConfig.rootUrl = "\/";</script>






</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            <img src="/img/avatar.png" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">Shirly</a></h1>
        </hgroup>

        

        
            <form id="search-form">
            <input type="text" id="local-search-input" name="q" placeholder="search..." class="search form-control" autocomplete="off" autocorrect="off" searchonload="false" />
            <i class="fa fa-times" onclick="resetSearch()"></i>
            </form>
            <div id="local-search-result"></div>
            <p class='no-result'>No results found <i class='fa fa-spinner fa-pulse'></i></p>
        


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜單</li>
                        <li>標籤</li>
                        
                        <li>友情鏈接</li>
                        
                        
                        <li>關於我</li>
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">主页</a></li>
                        
                            <li><a href="/archives/">所有文章</a></li>
                        
                            <li><a href="/tags/">分类</a></li>
                        
                            <li><a href="/about/">关于我</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" href="mailto:yqzh186@163.com" title="Email"></a>
                            
                                <a class="fa GitHub" href="#" title="GitHub"></a>
                            
                                <a class="fa RSS" href="/atom.xml" title="RSS"></a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/apt/">apt</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rails/">rails</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rake/">rake</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rspec/">rspec</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ruby/">ruby</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rvm/">rvm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/swift/">swift</a></li></ul>
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a class="main-nav-link switch-friends-link" href="https://hexo.io">Hexo</a>
                    
                      <a class="main-nav-link switch-friends-link" href="https://pages.github.com/">GitHub</a>
                    
                      <a class="main-nav-link switch-friends-link" href="http://moxfive.xyz/">MOxFIVE</a>
                    
                    </div>
                </section>
                

                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">专注于前端</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">Shirly</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img src="/img/avatar.png" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">Shirly</a></h1>
            </hgroup>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">主页</a></li>
                
                    <li><a href="/archives/">所有文章</a></li>
                
                    <li><a href="/tags/">分类</a></li>
                
                    <li><a href="/about/">关于我</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" target="_blank" href="mailto:yqzh186@163.com" title="Email"></a>
                            
                                <a class="fa GitHub" target="_blank" href="#" title="GitHub"></a>
                            
                                <a class="fa RSS" target="_blank" href="/atom.xml" title="RSS"></a>
                            
                        </ul>
            </nav>
        </header>                
    </div>
    <link class="menu-list" tags="標籤" friends="友情鏈接" about="關於我"/>
</nav>
      <div class="body-wrap">
  
    <article id="post-tableview 下拉图片放大" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/10/08/tableview 下拉图片放大/" class="article-date">
      <time datetime="2016-10-08T03:39:43.000Z" itemprop="datePublished">2016-10-08</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/10/08/tableview 下拉图片放大/">tableview 下拉图片放大</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <a id="more"></a>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="meta">#import <span class="meta-string">"RootViewController.h"</span></span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">RootViewController</span> ()</span></div><div class="line"></div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">RootViewController</span></span></div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</div><div class="line">    [<span class="keyword">super</span> viewDidLoad];</div><div class="line">    <span class="comment">// Do any additional setup after loading the view.</span></div><div class="line"></div><div class="line">    <span class="keyword">self</span>.view.backgroundColor = [<span class="built_in">UIColor</span> lightGrayColor];</div><div class="line"></div><div class="line">    [<span class="keyword">self</span> setAutomaticallyAdjustsScrollViewInsets:<span class="literal">NO</span>];</div><div class="line"></div><div class="line">    <span class="keyword">self</span>.myTableView = [[<span class="built_in">UITableView</span> alloc] initWithFrame:[[<span class="built_in">UIScreen</span> mainScreen] bounds] style:<span class="built_in">UITableViewStylePlain</span>];</div><div class="line">    [<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.myTableView];</div><div class="line">    [_myTableView release];</div><div class="line"></div><div class="line">    <span class="comment">//设置tableview的contentView距离上边界200</span></div><div class="line">    <span class="comment">//相对于0点,已经向下偏移了-200</span></div><div class="line">    <span class="keyword">self</span>.myTableView.contentInset = <span class="built_in">UIEdgeInsetsMake</span>(<span class="number">200.0</span>+<span class="number">64</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line">    <span class="keyword">self</span>.myTableView.delegate = <span class="keyword">self</span>;</div><div class="line">    <span class="keyword">self</span>.myTableView.dataSource = <span class="keyword">self</span>;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">//相对于0点,图片坐标应该是(0,-200)</span></div><div class="line">    <span class="keyword">self</span>.imageView = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">-200.0</span>, <span class="keyword">self</span>.view.frame.size.width, <span class="number">200</span>)];</div><div class="line">    <span class="keyword">self</span>.imageView.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"hua.jpg"</span>];</div><div class="line">    <span class="comment">//设置imageView高度改变时宽度也跟着改变</span></div><div class="line">    <span class="keyword">self</span>.imageView.contentMode = <span class="built_in">UIViewContentModeScaleAspectFill</span>;</div><div class="line">    [<span class="keyword">self</span>.myTableView addSubview:<span class="keyword">self</span>.imageView];</div><div class="line">    [_imageView release];</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">//指定多少行</span></div><div class="line">-(<span class="built_in">NSInteger</span>)tableView:(<span class="built_in">UITableView</span> *)tableView numberOfRowsInSection:(<span class="built_in">NSInteger</span>)section</div><div class="line">&#123;</div><div class="line">    <span class="keyword">return</span> <span class="number">10</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//创建一个cell</span></div><div class="line">-(<span class="built_in">UITableViewCell</span> *)tableView:(<span class="built_in">UITableView</span> *)tableView cellForRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath</div><div class="line">&#123;</div><div class="line">    <span class="built_in">NSString</span> *cellIdentifier = <span class="string">@"cell"</span>;</div><div class="line">  <span class="built_in">UITableViewCell</span> *cell =  [tableView dequeueReusableCellWithIdentifier:cellIdentifier];</div><div class="line">    <span class="keyword">if</span> (!cell) &#123;</div><div class="line">        cell = [[<span class="built_in">UITableViewCell</span> alloc] initWithStyle:<span class="built_in">UITableViewCellStyleDefault</span> reuseIdentifier:cellIdentifier];</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    cell.textLabel.text = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%ld"</span>,indexPath.row];</div><div class="line">    cell.selectionStyle =  <span class="built_in">UITableViewCellSelectionStyleNone</span>;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> cell;</div><div class="line"></div><div class="line">&#125;</div><div class="line"><span class="comment">//设置行高</span></div><div class="line">-(<span class="built_in">CGFloat</span>)tableView:(<span class="built_in">UITableView</span> *)tableView heightForRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath</div><div class="line">&#123;</div><div class="line">    <span class="keyword">return</span> <span class="number">80</span>;</div><div class="line">&#125;</div><div class="line">-(<span class="keyword">void</span>)tableView:(<span class="built_in">UITableView</span> *)tableView didSelectRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath</div><div class="line">&#123;</div><div class="line">    <span class="comment">//点击后自动取消选中置灰效果</span></div><div class="line">    [tableView deselectRowAtIndexPath:indexPath animated:<span class="literal">YES</span>];</div><div class="line"></div><div class="line">&#125;</div><div class="line">-(<span class="keyword">void</span>)scrollViewDidScroll:(<span class="built_in">UIScrollView</span> *)scrollView</div><div class="line">&#123;</div><div class="line">    <span class="comment">//刚开始y的偏移量初始值就是-264</span></div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"y1 === %f"</span>,scrollView.contentOffset.y);</div><div class="line">    <span class="built_in">CGFloat</span> y = scrollView.contentOffset.y + <span class="number">64</span>;<span class="comment">//加上导航栏高度,第一次是-200</span></div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"y2 === %f"</span>,y);</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (y &lt; <span class="number">-200</span>) &#123;</div><div class="line">        <span class="built_in">CGRect</span> frame = <span class="keyword">self</span>.imageView.frame;</div><div class="line">        frame.origin.y = y;<span class="comment">//imageView的frame是不断往上偏移</span></div><div class="line">        frame.size.height =  -y;<span class="comment">//tablview向下偏移了多少,高度就增加多少</span></div><div class="line">        <span class="keyword">self</span>.imageView.frame = frame;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)didReceiveMemoryWarning &#123;</div><div class="line">    [<span class="keyword">super</span> didReceiveMemoryWarning];</div><div class="line">    <span class="comment">// Dispose of any resources that can be recreated.</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/objective-c/">objective-c</a>
    </div>


      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Core Animation 3D介绍(第1部分)" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/10/08/Core Animation 3D介绍(第1部分)/" class="article-date">
      <time datetime="2016-10-08T03:39:43.000Z" itemprop="datePublished">2016-10-08</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/10/08/Core Animation 3D介绍(第1部分)/">Core Animation 3D介绍(第1部分)</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <a id="more"></a>
<p>尊重原创 转自：<a href="http://codingobjc.com/blog/2013/06/11/core-animation-3djie-shao-di-1bu-fen/" target="_blank" rel="external">http://codingobjc.com/blog/2013/06/11/core-animation-3djie-shao-di-1bu-fen/</a></p>
<p>在本教程中，我将向你介绍Core Animation中用于绘制3D图形的一些技术。<br>我要告诉你的好消息是：我们不必直接使用OpenGL，仅仅用Core Animation就可以很容易的实现一些3D效果。但是，也别太高兴了，因为”用Core Animation来制作一个复杂的3D游戏”也并不是一个好主意。<br>这个教程分两部分。第一部分，我们先讨论下一些3D原理知识，然后运用这些概念来创建一些简单的3D场景。然后在第二部分中，我们将使用Core Animation来制作一个类似于旋转木马的3D场景特效。<br>最终app的预览效果如下：(译注: 原文中这里的视频被墙，因此这里只简单的提供一个图片预览，你可以直接下载例子代码运行即可以看到最终app的效果)<br><img src="http://codingobjc.com/images/posts/2013_06_11_core_animation_3d_app_preview.png" alt=""><br>好，准备好了吗？我们开始写代码吧！<br>首先，下载文章后面的代码。如果你要自己创建项目的话，要记得添加QuartzCore框架。</p>
<p>###3D和矩阵相关的数学知识(一点点…别担心，只有一点点)<br>要在一个3D空间中绘图，除了标准2D坐标(X和Y)概念外，我们还需要引入一个深度(depth)的概念，也就是要加入第三个坐标轴–Z轴。<br>这样，在空间中，我们只需要简单的改变物体的X、Y和Z坐标，就可以在垂直方向、水平方向或深度方向上移动物体。<br><img src="http://www.thinkandbuild.it/wp-content/uploads/2013/03/handed.png" alt=""><br>在2D或3D空间中，对一个物体执行平移、缩放或旋转这些操作时需要使用矩阵运算。<br>你可以将矩阵想象成一个多维数组。比如，在3D空间中我们使用一个像下面这种格式的4X4矩阵：</p>
<pre><code>[X][0][0][0][0][Y][0][0][0][0][Z][0][0][0][0][1]
</code></pre><p>把这个矩阵和物体的每一个坐标点(又称顶点)相乘，我们可以得到物体的一个变换(transformation)效果。<br>严格点讲，前面这个矩阵是用来执行缩放操作的。其中的X、Y、Z值代表每个轴上的缩放值。<br>如果你要进行其他的变换操作，比如旋转或者平移，你需要将矩阵换成其他矩阵格式(scheme)。<br><img src="http://www.thinkandbuild.it/wp-content/uploads/2013/03/Screen-Shot-2013-03-20-at-11.02.03-AM.png" alt=""><br>不要紧张！你不需要知道其他更多原理知识，而且也不必直接进行这些操作。Core Animation会为你完成这些操作，虽然你不知道它是如何做到的，但是它确实会为你完成这些操作，所以不必害怕。<br>当然，就我个人来说，如果我知道它背后是如何工作的(至少知道一些它的基本原理)，我会对我的代码更有自信。因此，如果你想了解更多矩阵相关的知识，建议你读一读这篇<a href="http://www.matrix44.net/cms/notes/opengl-3d-graphics/basic-3d-math-matrices" target="_blank" rel="external">文章</a>。</p>
<p>###3D变换(Transformations)<br>现在基本上，你已经知道矩阵的作用了，也知道了3D空间是如何构成的。来，我们用Core Animation做一些3D的东西吧。<br>打开TB_3DIntro-&gt;viewController.m文件。<br>我在里面列出了6个分别以A、B、C、D、E、F开头的函数。每一个函数对应了一种不同的3D场景效果。<br>我们先来看看由<code>A_singlePlan</code>函数创造的场景吧。<br>用这个函数，我们画了一个平面，平面绕Y轴旋转了45度。<br>首先，我们创建了一个CALayer，用它来作容器层(当然，并不是一定要这样做，只是我更喜欢不直接在self.view的layer上进行工作)。</p>
<pre><code>-(void)A_singlePlane{//Create the containerCALayer*container=[CALayerlayer];container.frame=CGRectMake(0,0,640,300);[self.view.layeraddSublayer:container];
</code></pre><p>然后我们创建了另一个CALayer，用它代表一个平面。</p>
<pre><code>//Create a PlaneCALayer*purplePlane=[selfaddPlaneToLayer:containersize:CGSizeMake(100,100)position:CGPointMake(250,150)color:[UIColorpurpleColor]];
</code></pre><p>我写了一个简单的辅助函数，用它将平面直接添加到容器层上，然后返回这个新建的平面层。代码非常简单：</p>
<pre><code>-(CALayer*)addPlaneToLayer:(CALayer*)containersize:(CGSize)sizeposition:(CGPoint)pointcolor:(UIColor*)color{//Initialize the layerCALayer*plane=[CALayerlayer];//Define position,size and colorsplane.backgroundColor=[colorCGColor];plane.opacity=0.6;plane.frame=CGRectMake(0,0,size.width,size.height);plane.position=point;plane.anchorPoint=CGPointMake(0.5,0.5);plane.borderColor=[[UIColorcolorWithWhite:1.0alpha:0.5]CGColor];plane.borderWidth=3;plane.cornerRadius=10;//Add the layer to the container layer[containeraddSublayer:plane];returnplane;}
</code></pre><p>最后，我们用CATransform3D来添加变换。<br>啊？？？你一定又想问CATransform3D是什么东西？按住Cmd键点击这个类型名称，你可以发现它是一个结构体，使用了一种很”火星”的语法来表示一个矩阵。<img src="http://www.thinkandbuild.it/wp-includes/images/smilies/icon_razz.gif" alt=""></p>
<pre><code>structCATransform3D{CGFloatm11,m12,m13,m14;CGFloatm21,m22,m23,m24;CGFloatm31,m32,m33,m34;CGFloatm41,m42,m43,m44;};typedefstructCATransform3DCATransform3D;
</code></pre><p>旋转变换部分的代码也相当简单：</p>
<pre><code>//Apply transform to the PLANECATransform3Dt=CATransform3DIdentity;t=CATransform3DRotate(t,45.00f*M_PI/180.0f,0,1,0);purplePlane.transform=t;}
</code></pre><p>先用单位矩阵<code>CATransform3DIdentity</code>来初始化一个变换(transformation)，然后用<code>CATransform3DRotate</code>函数给变换乘上一个旋转矩阵。<br>CATransform3DRotate这个函数的参数分别表示矩阵，旋转的角度(以弧度为单位)和3个坐标轴上的变换系数。这个例子中，X和Z轴都没受到影响，只对Y轴有影响，物体会在Y轴上旋转45度。<br>下图是运行结果。<br><img src="http://www.thinkandbuild.it/wp-content/uploads/2013/03/pa1.png" alt=""><br>呃……你可以看到，它还不是3D的！我们只是在X轴方向上将一个正方形压扁了。<br>这是由于我们还没有设置视点的值(perspective value)。通常，在绘制3D场景的时候会将场景进行正射投影(Orthographic projection)处理，由此会产生一个扁平的场景。换句话说，在正射投影后你无法看到Z轴上的深度感。<br>要给我们的场景加上空间深度感，我们必须修改变换矩阵的<code>m34</code>参数。这个参数决定了视点的值。<br>现在，来看看<code>B_singlePlanePerspective</code>这个函数，这函数展示了视点的作用。<br>这个函数和前一个函数只有变换部分的代码有所不同：</p>
<pre><code>//Apply transform to the PLANECATransform3Dt=CATransform3DIdentity;//Add perspective!!!t.m34=1.0/-500;t=CATransform3DRotate(t,degToRad(45.0),0,1,0);purplePlane.transform=t;}
</code></pre><p>你可以看到，我们直接给矩阵的m34属性赋了一个值。在这里，我不会深入的从数学上解释这个值是如何起作用的。但是我可以告诉你的是，这个值越接近0，视点就越深。<br>下面是两种不同视点值的效果：<br><img src="http://www.thinkandbuild.it/wp-content/uploads/2013/03/pa_2.png" alt=""><br><img src="http://www.thinkandbuild.it/wp-content/uploads/2013/03/pa_21.png" alt=""></p>
<p>###3D变换的顺序问题(Transformations chain)<br>我们可以将多个矩阵相乘从而将多种变换应用到一个物体上。比如，如果我们想将平移和旋转变换应用到一个物体上，我们可以直接将两个变换矩阵相乘：</p>
<pre><code>TransformMatrix=TranslateMtx*RotateMtx
</code></pre><p>数学上，一般情况下乘法都可以使用交换律：</p>
<pre><code>TranslateMtx*RotateMxt=RotateMtx*TranslateMtx
</code></pre><p>但是矩阵乘法不适用于交换律。AxB的结果可能和BxA的结果不一样。要记住这一点！<br>接下来<code>C_transformationsChain</code>这个例子中，我们会将2个变换效果按不同的先后顺序应用到2个不同的物体上。<br>以下是主要代码：</p>
<pre><code>//Apply transformation to the PLANESCATransform3Dt=CATransform3DIdentity;//Purple plane: Perform a rotation and then a translationt=CATransform3DRotate(t,45.0f*M_PI/180.0f,0,0,1);t=CATransform3DTranslate(t,100,0,0);purplePlane.transform=t;//reset the transform matrixt=CATransform3DIdentity;//Red plane: Perform translation first and then the rotationt=CATransform3DTranslate(t,100,0,0);t=CATransform3DRotate(t,45.0f*M_PI/180.0f,0,0,1);redPlane.transform=t;
</code></pre><p>运行结果如下：<br><img src="http://www.thinkandbuild.it/wp-content/uploads/2013/03/Screen-Shot-2013-03-20-at-11.47.15-AM.png" alt=""><br>看到了吗，不同的变换顺序完全导致了不同的效果。<br>我们重点下看一下紫色的那块。旋转变换改变了它的坐标轴方向，然后我们又将它沿X轴进行了平移，此时它的X轴方向已经和红色平面的X轴方向不一致了。<br>变换步骤示意图如下：<br><img src="http://www.thinkandbuild.it/wp-content/uploads/2013/03/p_r.png" alt=""><br><img src="http://www.thinkandbuild.it/wp-content/uploads/2013/03/p_r2.png" alt=""></p>
<p>###图层层次(layer hierarchies)<br>到目前为止，我们都是将变换直接应用在这些平面上。在3D场景中，经常需要创建一些相互之间有层次结构的物体。这个时候，只需要将变换应用到根层次上，就可以使整个层次结构中的物体整体具有这个变换效果。这种做法非常有用。<br>接下来，我们来看看<code>D_multiplePlanes</code>这个例子。<br>我们在容器层上添加了4个平面。<br>当没有任何变换效果时看起来是这样的：<br><img src="http://www.thinkandbuild.it/wp-content/uploads/2013/03/p5.png" alt=""><br>如果我们给每一个平面都加上一个Y轴上的旋转变换，我们会得到4个独立的旋转效果：<br><img src="http://www.thinkandbuild.it/wp-content/uploads/2013/03/p5_2.png" alt=""><br>但是，如果我们只是在容器层上应用旋转变换，我们会得到一个完全不同的场景效果：<br><img src="http://www.thinkandbuild.it/wp-content/uploads/2013/03/p5_1.png" alt=""><br>这种效果，是相机(camera)位置发生改变带来的结果。我们没有移动每个平面，只是改变了视点的位置。<br>此函数主要的变换部分代码如下，包含了分别应用于各个平面和应用于容器层的两种变换效果的代码：</p>
<pre><code>//Transformation CATransform3Dt=CATransform3DIdentity;BOOLapplyToContainer=NO;//Apply the transformation to each PLANEif(!applyToContainer){t.m34=1.0/-500.0;t=CATransform3DRotate(t,degToRad(60.0),0,1,0);purplePlane.transform=t;t=CATransform3DIdentity;t.m34=1.0/-500.0;t=CATransform3DRotate(t,degToRad(60.0),0,1,0);redPlane.transform=t;t=CATransform3DIdentity;t.m34=1.0/-500.0;t=CATransform3DRotate(t,degToRad(60.0),0,1,0);orangePlane.transform=t;t=CATransform3DIdentity;t.m34=1.0/-500.0;t=CATransform3DRotate(t,degToRad(60.0),0,1,0);yellowPlane.transform=t;}//Apply the transformation to the CONTAINERelse{CATransform3Dt=CATransform3DIdentity;t.m34=1.0/-500;t=CATransform3DRotate(t,degToRad(60.0),0,1,0);container.transform=t;}
</code></pre><p>###CATransformLayer<br>到目前为止我们所见到的代码都能正常工作，但说实话，作为3D层次结构的根，CALayer不是正确的选择。<br>函数<code>E_multiplePlanesZAxis</code>展示了为什么。<br>这个例子中，我们创建4个XY坐标相同只有Z坐标不同的平面。紫色平面最近，黄色平面最远。</p>
<pre><code>//Apply transforms to the PLANESt=CATransform3DIdentity;t=CATransform3DTranslate(t,0,0,-10);purplePlane.transform=t;t=CATransform3DIdentity;t=CATransform3DTranslate(t,0,0,-50);redPlane.transform=t;t=CATransform3DIdentity;t=CATransform3DTranslate(t,0,0,-90);orangePlane.transform=t;t=CATransform3DIdentity;t=CATransform3DTranslate(t,0,0,-130);yellowPlane.transform=t;
</code></pre><p>在旋转这些平面前，我们先让容器层执行了一个旋转变换。</p>
<pre><code>//Apply transform to the CONTAINERCATransform3Dt=CATransform3DIdentity;t.m34=1.0/-500;t=CATransform3DRotate(t,80.0f*M_PI/180.0f,0,1,0);container.transform=t;
</code></pre><p>你也许希望看到下面这种结果：<br><img src="http://www.thinkandbuild.it/wp-content/uploads/2013/03/p6_1.png" alt=""><br>但是，实际上会得到这种结果：<br><img src="http://www.thinkandbuild.it/wp-content/uploads/2013/03/p6.png" alt=""><br>这是因为CALayer不能处理3D层次结构的深度，它只能将场景处理成相同的Z层次。<br>为了修正这个问题，我们需要用一个<code>CATransformLayers</code>来做根层对象。<br>函数<code>F_multiplePlanesZAxis</code>修正了这个问题：</p>
<pre><code>//Create the container as a CATransformLayerCATransformLayer*container=[CATransformLayerlayer];container.frame=CGRectMake(0,0,640,300);[self.view.layeraddSublayer:container];
</code></pre><p>CATransformLayer是一个特殊的layer。与CALayer的不同之处在于，CATransformLayer本身不会被渲染到屏幕上，只有它的子图层才会被渲染到屏幕上。所以它的一些属性，比如backgroundColor、contents、border等等都没有什么用。要记住这点。<br>到这里，这个教程的第一部分就完了。建议你实际运行一下这些函数，也可以试试我没有讲到的<code>CATransform3DScale</code>，试试用它做一个缩放变换看。<br>如果你有任何问题，可以在twitter上找到我(<a href="http://www.twitter.com/bitwaker" target="_blank" rel="external">@bitwaker</a>)。<br><a href="https://github.com/ariok/TB_3DCoreAnimation" target="_blank" rel="external">本教程代码下载</a><br>译自：<a href="http://www.thinkandbuild.it/introduction-to-3d-drawing-in-core-animation-part-1/" target="_blank" rel="external">Think<br> &amp; Build</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/objective-c/">objective-c</a>
    </div>


      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-target action" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/10/08/target action/" class="article-date">
      <time datetime="2016-10-08T03:39:43.000Z" itemprop="datePublished">2016-10-08</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/10/08/target action/">target action</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <a id="more"></a>
<p>//自定义target:<br> action:方法</p>
<p>#warning第一步声明target和action属性@property(nonatomic,assign)idmyTarget;<br>@property(nonatomic,assign)SELmyAction;</p>
<p>#warning第二部声明方法-(void)addmyTarget:(id)target<br> Ation:(SEL)action;</p>
<p>#warning第三步实现方法<br>-(void)addmyTarget:(id)target<br> Ation:(SEL)action{</p>
<p>#warning第四步接收传进来的目标对象和行为方法<br>   self.myTarget= target;<br>   self.myAction= action;</p>
<p>}</p>
<p>#warning第五步使用目标对象去执行行为方法<br>-(void)touchesBegan:(NSSet<em>)touches withEvent:(UIEvent</em>)event<br>{</p>
<pre><code>[self.myTargetperformSelector:self.myActionwithObject:nil];}
</code></pre>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/objective-c/">objective-c</a>
    </div>


      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-通讯录" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/10/08/通讯录/" class="article-date">
      <time datetime="2016-10-08T03:39:43.000Z" itemprop="datePublished">2016-10-08</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/10/08/通讯录/">通讯录</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <a id="more"></a>
<p>通讯录<br>AddressBook<br>iOS中带有一个Contacts应用程序来管理联系人，但是有些时候我们希望自己的应用能够访问或者修改这些信息，这个时候就要用到AddressBook.framework框架。iOS中的通讯录是存储在数据库中的，由于iOS的权限设计，开发人员是不允许直接访问通讯录数据库的，必须依靠AddressBook提供的标准API来实现通讯录操作。通过AddressBook.framework开发者可以从底层去操作AddressBook.framework的所有信息，但是需要注意的是这个框架是基于C语言编写的，无法使用ARC来管理内存，开发者需要自己管理内存。下面大致介绍一下通讯录操作中常用的类型：<br>ABAddressBookRef：代表通讯录对象，通过该对象开发人员不用过多的关注通讯录的存储方式，可以直接以透明的方式去访问、保存（在使用AddressBook.framework操作联系人时，所有的增加、删除、修改后都必须执行保存操作，类似于Core Data）等。<br>ABRecordRef：代表一个通用的记录对象，可以是一条联系人信息，也可以是一个群组，可以通过ABRecordGetRecordType()函数获得具体类型。如果作为联系人（事实上也经常使用它作为联系人），那么这个记录记录了一个完整的联系人信息（姓名、性别、电话、邮件等），每条记录都有一个唯一的ID标示这条记录（可以通过ABRecordGetRecordID()函数获得）。<br>ABPersonRef：代表联系人信息，很少直接使用，实际开发过程中通常会使用类型为“kABPersonType”的ABRecordRef来表示联系人（由此可见ABPersonRef其实是一种类型为“kABPersonType”的ABRecordRef）<br>ABGroupRef：代表群组，与ABPersonRef类似，很少直接使用ABGroupRef，而是使用类型为“kABGroupType”的ABRecordRef来表示群组，一个群组可以包含多个联系人，一个联系人也同样可以多个群组。<br>由于通讯录操作的关键是对ABRecordRef的操作，首先看一下常用的操作通讯录记录的方法：<br>ABPersonCreate():创建一个类型为“kABPersonType”的ABRecordRef。<br>ABRecordCopyValue():取得指定属性的值。<br>ABRecordCopyCompositeName():取得联系人（或群组）的复合信息（对于联系人则包括：姓、名、公司等信息，对于群组则返回组名称）。<br>ABRecordSetValue():设置ABRecordRef的属性值。注意在设置ABRecordRef的值时又分为单值属性和多值属性：单值属性设置只要通过ABRecordSetValue()方法指定属性名和值即可；多值属性则要先通过创建一个ABMutableMultiValueRef类型的变量，然后通过ABMultiValueAddValueAndLabel()方法依次添加属性值，最后通过ABRecordSetValue()方法将ABMutableMultiValueRef类型的变量设置为记录值。<br>ABRecordRemoveValue():删除指定的属性值。<br>注意：<br>由于联系人访问时（读取、设置、删除时）牵扯到大量联系人属性，可以到ABPerson.h中查询或者直接到帮助文档“Personal Information Properties”<br>通讯录的访问步骤一般如下：<br>调用ABAddressBookCreateWithOptions()方法创建通讯录对象ABAddressBookRef。<br>调用ABAddressBookRequestAccessWithCompletion()方法获得用户授权访问通讯录。<br>调用ABAddressBookCopyArrayOfAllPeople()、ABAddressBookCopyPeopleWithName()方法查询联系人信息。<br>读取联系人后如果要显示联系人信息则可以调用ABRecord相关方法读取相应的数据；如果要进行修改联系人信息，则可以使用对应的方法修改ABRecord信息，然后调用ABAddressBookSave()方法提交修改；如果要删除联系人，则可以调用ABAddressBookRemoveRecord()方法删除，然后调用ABAddressBookSave()提交修改操作。<br>也就是说如果要修改或者删除都需要首先查询对应的联系人，然后修改或删除后提交更改。如果用户要增加一个联系人则不用进行查询，直接调用ABPersonCreate()方法创建一个ABRecord然后设置具体的属性，调用ABAddressBookAddRecord方法添加即可。<br>下面就通过一个示例演示一下如何通过ABAddressBook.framework访问通讯录，这个例子中通过一个UITableViewController模拟一下通讯录的查看、删除、添加操作。<br>主控制器视图，用于显示联系人，修改删除联系人：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div><div class="line">338</div><div class="line">339</div><div class="line">340</div><div class="line">341</div><div class="line">342</div><div class="line">343</div><div class="line">344</div><div class="line">345</div><div class="line">346</div><div class="line">347</div><div class="line">348</div><div class="line">349</div><div class="line">350</div><div class="line">351</div><div class="line">352</div><div class="line">353</div><div class="line">354</div><div class="line">355</div><div class="line">356</div><div class="line">357</div><div class="line">358</div><div class="line">359</div><div class="line">360</div><div class="line">361</div><div class="line">362</div></pre></td><td class="code"><pre><div class="line">KCContactViewController.h</div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">//  KCTableViewController.h</span></div><div class="line"><span class="comment">//  AddressBook</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">//  Created by Kenshin Cui on 14/04/05.</span></div><div class="line"><span class="comment">//  Copyright (c) 2014年 cmjstudio. All rights reserved.</span></div><div class="line"><span class="comment">//</span></div><div class="line"></div><div class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> *  定义一个协议作为代理</div><div class="line"> */</div><div class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">KCContactDelegate</span></span></div><div class="line"><span class="comment">//新增或修改联系人</span></div><div class="line">-(<span class="keyword">void</span>)editPersonWithFirstName:(<span class="built_in">NSString</span> *)firstName lastName:(<span class="built_in">NSString</span> *)lastName workNumber:(<span class="built_in">NSString</span> *)workNumber;</div><div class="line"><span class="comment">//取消修改或新增</span></div><div class="line">-(<span class="keyword">void</span>)cancelEdit;</div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">KCContactTableViewController</span> : <span class="title">UITableViewController</span></span></div><div class="line"></div><div class="line"><span class="keyword">@end</span></div><div class="line">KCContactViewController.m</div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">//  KCTableViewController.m</span></div><div class="line"><span class="comment">//  AddressBook</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">//  Created by Kenshin Cui on 14/04/05.</span></div><div class="line"><span class="comment">//  Copyright (c) 2014年 cmjstudio. All rights reserved.</span></div><div class="line"><span class="comment">//</span></div><div class="line"></div><div class="line"><span class="meta">#import <span class="meta-string">"KCContactTableViewController.h"</span></span></div><div class="line"><span class="meta">#import <span class="meta-string">&lt;AddressBook/AddressBook.h&gt;</span></span></div><div class="line"><span class="meta">#import <span class="meta-string">"KCAddPersonViewController.h"</span></span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">KCContactTableViewController</span> ()&lt;<span class="title">KCContactDelegate</span>&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">assign</span>,<span class="keyword">nonatomic</span>) ABAddressBookRef addressBook;<span class="comment">//通讯录</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>,<span class="keyword">nonatomic</span>) <span class="built_in">NSMutableArray</span> *allPerson;<span class="comment">//通讯录所有人员</span></div><div class="line"></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">assign</span>,<span class="keyword">nonatomic</span>) <span class="keyword">int</span> isModify;<span class="comment">//标识是修改还是新增，通过选择cell进行导航则认为是修改，否则视为新增</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">assign</span>,<span class="keyword">nonatomic</span>) <span class="built_in">UITableViewCell</span> *selectedCell;<span class="comment">//当前选中的单元格</span></div><div class="line"></div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">KCContactTableViewController</span></span></div><div class="line"></div><div class="line"><span class="meta">#pragma mark - 控制器视图</span></div><div class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</div><div class="line">    [<span class="keyword">super</span> viewDidLoad];</div><div class="line"> </div><div class="line">    <span class="comment">//请求访问通讯录并初始化数据</span></div><div class="line">    [<span class="keyword">self</span> requestAddressBook];</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//由于在整个视图控制器周期内addressBook都驻留在内存中，所有当控制器视图销毁时销毁该对象</span></div><div class="line">-(<span class="keyword">void</span>)dealloc&#123;</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.addressBook!=<span class="literal">NULL</span>) &#123;</div><div class="line">        <span class="built_in">CFRelease</span>(<span class="keyword">self</span>.addressBook);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">#pragma mark - UI事件</span></div><div class="line"><span class="comment">//点击删除按钮</span></div><div class="line">- (<span class="keyword">IBAction</span>)trashClick:(<span class="built_in">UIBarButtonItem</span> *)sender &#123;</div><div class="line">    <span class="keyword">self</span>.tableView.editing=!<span class="keyword">self</span>.tableView.editing;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="meta">#pragma mark - UITableView数据源方法</span></div><div class="line"></div><div class="line">- (<span class="built_in">NSInteger</span>)numberOfSectionsInTableView:(<span class="built_in">UITableView</span> *)tableView &#123;</div><div class="line">    <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="built_in">NSInteger</span>)tableView:(<span class="built_in">UITableView</span> *)tableView numberOfRowsInSection:(<span class="built_in">NSInteger</span>)section &#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">self</span>.allPerson.count;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">- (<span class="built_in">UITableViewCell</span> *)tableView:(<span class="built_in">UITableView</span> *)tableView cellForRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath &#123;</div><div class="line">    <span class="keyword">static</span> <span class="built_in">NSString</span> *identtityKey=<span class="string">@"myTableViewCellIdentityKey1"</span>;</div><div class="line">    <span class="built_in">UITableViewCell</span> *cell=[tableView dequeueReusableCellWithIdentifier:identtityKey];</div><div class="line">    <span class="keyword">if</span>(cell==<span class="literal">nil</span>)&#123;</div><div class="line">        cell=[[<span class="built_in">UITableViewCell</span> alloc]initWithStyle:<span class="built_in">UITableViewCellStyleValue1</span> reuseIdentifier:identtityKey];</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//取得一条人员记录</span></div><div class="line">    ABRecordRef recordRef=(__bridge ABRecordRef)<span class="keyword">self</span>.allPerson[indexPath.row];</div><div class="line">    <span class="comment">//取得记录中得信息</span></div><div class="line">    <span class="built_in">NSString</span> *firstName=(__bridge <span class="built_in">NSString</span> *) ABRecordCopyValue(recordRef, kABPersonFirstNameProperty);<span class="comment">//注意这里进行了强转，不用自己释放资源</span></div><div class="line">    <span class="built_in">NSString</span> *lastName=(__bridge <span class="built_in">NSString</span> *)ABRecordCopyValue(recordRef, kABPersonLastNameProperty);</div><div class="line">    </div><div class="line">    ABMultiValueRef phoneNumbersRef= ABRecordCopyValue(recordRef, kABPersonPhoneProperty);<span class="comment">//获取手机号，注意手机号是ABMultiValueRef类，有可能有多条</span></div><div class="line"><span class="comment">//    NSArray *phoneNumbers=(__bridge NSArray *)ABMultiValueCopyArrayOfAllValues(phoneNumbersRef);//取得CFArraryRef类型的手机记录并转化为NSArrary</span></div><div class="line">    <span class="keyword">long</span> count= ABMultiValueGetCount(phoneNumbersRef);</div><div class="line"><span class="comment">//    for(int i=0;i&lt;count;++i)&#123;</span></div><div class="line"><span class="comment">//        NSString *phoneLabel= (__bridge NSString *)(ABMultiValueCopyLabelAtIndex(phoneNumbersRef, i));</span></div><div class="line"><span class="comment">//        NSString *phoneNumber=(__bridge NSString *)(ABMultiValueCopyValueAtIndex(phoneNumbersRef, i));</span></div><div class="line"><span class="comment">//        NSLog(@"%@:%@",phoneLabel,phoneNumber);</span></div><div class="line"><span class="comment">//    &#125;</span></div><div class="line">    </div><div class="line">    cell.textLabel.text=[<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%@ %@"</span>,firstName,lastName];</div><div class="line">    <span class="keyword">if</span> (count&gt;<span class="number">0</span>) &#123;</div><div class="line">        cell.detailTextLabel.text=(__bridge <span class="built_in">NSString</span> *)(ABMultiValueCopyValueAtIndex(phoneNumbersRef, <span class="number">0</span>));</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(ABPersonHasImageData(recordRef))&#123;<span class="comment">//如果有照片数据</span></div><div class="line">        <span class="built_in">NSData</span> *imageData= (__bridge <span class="built_in">NSData</span> *)(ABPersonCopyImageData(recordRef));</div><div class="line">        cell.imageView.image=[<span class="built_in">UIImage</span> imageWithData:imageData];</div><div class="line">    &#125;<span class="keyword">else</span>&#123;</div><div class="line">        cell.imageView.image=[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"avatar"</span>];<span class="comment">//没有图片使用默认头像</span></div><div class="line">    &#125;</div><div class="line">    <span class="comment">//使用cell的tag存储记录id</span></div><div class="line">    cell.tag=ABRecordGetRecordID(recordRef);</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> cell;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)tableView:(<span class="built_in">UITableView</span> *)tableView commitEditingStyle:(<span class="built_in">UITableViewCellEditingStyle</span>)editingStyle forRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath &#123;</div><div class="line">    <span class="keyword">if</span> (editingStyle == <span class="built_in">UITableViewCellEditingStyleDelete</span>) &#123;</div><div class="line">        ABRecordRef recordRef=(__bridge ABRecordRef )<span class="keyword">self</span>.allPerson[indexPath.row];</div><div class="line">        [<span class="keyword">self</span> removePersonWithRecord:recordRef];<span class="comment">//从通讯录删除</span></div><div class="line">        [<span class="keyword">self</span>.allPerson removeObjectAtIndex:indexPath.row];<span class="comment">//从数组移除</span></div><div class="line">        [tableView deleteRowsAtIndexPaths:@[indexPath] withRowAnimation:<span class="built_in">UITableViewRowAnimationFade</span>];<span class="comment">//从列表删除</span></div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (editingStyle == <span class="built_in">UITableViewCellEditingStyleInsert</span>) &#123;</div><div class="line">        <span class="comment">// Create a new instance of the appropriate class, insert it into the array, and add a new row to the table view</span></div><div class="line">    &#125;   </div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">#pragma mark - UITableView代理方法</span></div><div class="line">-(<span class="keyword">void</span>)tableView:(<span class="built_in">UITableView</span> *)tableView didSelectRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath&#123;</div><div class="line">    <span class="keyword">self</span>.isModify=<span class="number">1</span>;</div><div class="line">    <span class="keyword">self</span>.selectedCell=[tableView cellForRowAtIndexPath:indexPath];</div><div class="line">    [<span class="keyword">self</span> performSegueWithIdentifier:<span class="string">@"AddPerson"</span> sender:<span class="keyword">self</span>];</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">#pragma mark - Navigation</span></div><div class="line">- (<span class="keyword">void</span>)prepareForSegue:(<span class="built_in">UIStoryboardSegue</span> *)segue sender:(<span class="keyword">id</span>)sender &#123;</div><div class="line">    <span class="keyword">if</span>([segue.identifier isEqualToString:<span class="string">@"AddPerson"</span>])&#123;</div><div class="line">        <span class="built_in">UINavigationController</span> *navigationController=(<span class="built_in">UINavigationController</span> *)segue.destinationViewController;</div><div class="line">        <span class="comment">//根据导航控制器取得添加/修改人员的控制器视图</span></div><div class="line">        KCAddPersonViewController *addPersonController=(KCAddPersonViewController *)navigationController.topViewController;</div><div class="line">        addPersonController.delegate=<span class="keyword">self</span>;</div><div class="line">        <span class="comment">//如果是通过选择cell进行的导航操作说明是修改，否则为添加</span></div><div class="line">        <span class="keyword">if</span> (<span class="keyword">self</span>.isModify) &#123;</div><div class="line">            <span class="built_in">UITableViewCell</span> *cell=<span class="keyword">self</span>.selectedCell;</div><div class="line">            addPersonController.recordID=(ABRecordID)cell.tag;<span class="comment">//设置</span></div><div class="line">            <span class="built_in">NSArray</span> *array=[cell.textLabel.text componentsSeparatedByString:<span class="string">@" "</span>];</div><div class="line">            <span class="keyword">if</span> (array.count&gt;<span class="number">0</span>) &#123;</div><div class="line">                addPersonController.firstNameText=[array firstObject];</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (array.count&gt;<span class="number">1</span>) &#123;</div><div class="line">                addPersonController.lastNameText=[array lastObject];</div><div class="line">            &#125;</div><div class="line">            addPersonController.workPhoneText=cell.detailTextLabel.text;</div><div class="line">            </div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="meta">#pragma mark - KCContact代理方法</span></div><div class="line">-(<span class="keyword">void</span>)editPersonWithFirstName:(<span class="built_in">NSString</span> *)firstName lastName:(<span class="built_in">NSString</span> *)lastName workNumber:(<span class="built_in">NSString</span> *)workNumber&#123;</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.isModify) &#123;</div><div class="line">        <span class="built_in">UITableViewCell</span> *cell=<span class="keyword">self</span>.selectedCell;</div><div class="line">        <span class="built_in">NSIndexPath</span> *indexPath= [<span class="keyword">self</span>.tableView indexPathForCell:cell];</div><div class="line">        [<span class="keyword">self</span> modifyPersonWithRecordID:(ABRecordID)cell.tag firstName:firstName lastName:lastName workNumber:workNumber];</div><div class="line">        [<span class="keyword">self</span>.tableView reloadRowsAtIndexPaths:@[indexPath] withRowAnimation:<span class="built_in">UITableViewRowAnimationRight</span>];</div><div class="line">    &#125;<span class="keyword">else</span>&#123;</div><div class="line">        [<span class="keyword">self</span> addPersonWithFirstName:firstName lastName:lastName workNumber:workNumber];<span class="comment">//通讯簿中添加信息</span></div><div class="line">        [<span class="keyword">self</span> initAllPerson];<span class="comment">//重新初始化数据</span></div><div class="line">        [<span class="keyword">self</span>.tableView reloadData];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">self</span>.isModify=<span class="number">0</span>;</div><div class="line">&#125;</div><div class="line">-(<span class="keyword">void</span>)cancelEdit&#123;</div><div class="line">    <span class="keyword">self</span>.isModify=<span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">#pragma mark - 私有方法</span></div><div class="line"><span class="comment">/**</span></div><div class="line"> *  请求访问通讯录</div><div class="line"> */</div><div class="line">-(<span class="keyword">void</span>)requestAddressBook&#123;</div><div class="line">    <span class="comment">//创建通讯录对象</span></div><div class="line">    <span class="keyword">self</span>.addressBook=ABAddressBookCreateWithOptions(<span class="literal">NULL</span>, <span class="literal">NULL</span>);</div><div class="line">    </div><div class="line">    <span class="comment">//请求访问用户通讯录,注意无论成功与否block都会调用</span></div><div class="line">    ABAddressBookRequestAccessWithCompletion(<span class="keyword">self</span>.addressBook, ^(<span class="keyword">bool</span> granted, <span class="built_in">CFErrorRef</span> error) &#123;</div><div class="line">        <span class="keyword">if</span> (!granted) &#123;</div><div class="line">            <span class="built_in">NSLog</span>(<span class="string">@"未获得通讯录访问权限！"</span>);</div><div class="line">        &#125;</div><div class="line">        [<span class="keyword">self</span> initAllPerson];</div><div class="line">        </div><div class="line">    &#125;);</div><div class="line">&#125;</div><div class="line"><span class="comment">/**</span></div><div class="line"> *  取得所有通讯录记录</div><div class="line"> */</div><div class="line">-(<span class="keyword">void</span>)initAllPerson&#123;</div><div class="line">    <span class="comment">//取得通讯录访问授权</span></div><div class="line">    ABAuthorizationStatus authorization= ABAddressBookGetAuthorizationStatus();</div><div class="line">    <span class="comment">//如果未获得授权</span></div><div class="line">    <span class="keyword">if</span> (authorization!=kABAuthorizationStatusAuthorized) &#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"尚未获得通讯录访问授权！"</span>);</div><div class="line">        <span class="keyword">return</span> ;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//取得通讯录中所有人员记录</span></div><div class="line">    <span class="built_in">CFArrayRef</span> allPeople= ABAddressBookCopyArrayOfAllPeople(<span class="keyword">self</span>.addressBook);</div><div class="line">    <span class="keyword">self</span>.allPerson=(__bridge <span class="built_in">NSMutableArray</span> *)allPeople;</div><div class="line">    </div><div class="line">    <span class="comment">//释放资源</span></div><div class="line">    <span class="built_in">CFRelease</span>(allPeople);</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> *  删除指定的记录</div><div class="line"> *</div><div class="line"> *  @param recordRef 要删除的记录</div><div class="line"> */</div><div class="line">-(<span class="keyword">void</span>)removePersonWithRecord:(ABRecordRef)recordRef&#123;</div><div class="line">    ABAddressBookRemoveRecord(<span class="keyword">self</span>.addressBook, recordRef, <span class="literal">NULL</span>);<span class="comment">//删除</span></div><div class="line">    ABAddressBookSave(<span class="keyword">self</span>.addressBook, <span class="literal">NULL</span>);<span class="comment">//删除之后提交更改</span></div><div class="line">&#125;</div><div class="line"><span class="comment">/**</span></div><div class="line"> *  根据姓名删除记录</div><div class="line"> */</div><div class="line">-(<span class="keyword">void</span>)removePersonWithName:(<span class="built_in">NSString</span> *)personName&#123;</div><div class="line">    <span class="built_in">CFStringRef</span> personNameRef=(__bridge <span class="built_in">CFStringRef</span>)(personName);</div><div class="line">    <span class="built_in">CFArrayRef</span> recordsRef= ABAddressBookCopyPeopleWithName(<span class="keyword">self</span>.addressBook, personNameRef);<span class="comment">//根据人员姓名查找</span></div><div class="line">    <span class="built_in">CFIndex</span> count= <span class="built_in">CFArrayGetCount</span>(recordsRef);<span class="comment">//取得记录数</span></div><div class="line">    <span class="keyword">for</span> (<span class="built_in">CFIndex</span> i=<span class="number">0</span>; i&lt;count; ++i) &#123;</div><div class="line">        ABRecordRef recordRef=<span class="built_in">CFArrayGetValueAtIndex</span>(recordsRef, i);<span class="comment">//取得指定的记录</span></div><div class="line">        ABAddressBookRemoveRecord(<span class="keyword">self</span>.addressBook, recordRef, <span class="literal">NULL</span>);<span class="comment">//删除</span></div><div class="line">    &#125;</div><div class="line">    ABAddressBookSave(<span class="keyword">self</span>.addressBook, <span class="literal">NULL</span>);<span class="comment">//删除之后提交更改</span></div><div class="line">    <span class="built_in">CFRelease</span>(recordsRef);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> *  添加一条记录</div><div class="line"> *</div><div class="line"> *  @param firstName  名</div><div class="line"> *  @param lastName   姓</div><div class="line"> *  @param iPhoneName iPhone手机号</div><div class="line"> */</div><div class="line">-(<span class="keyword">void</span>)addPersonWithFirstName:(<span class="built_in">NSString</span> *)firstName lastName:(<span class="built_in">NSString</span> *)lastName workNumber:(<span class="built_in">NSString</span> *)workNumber&#123;</div><div class="line">    <span class="comment">//创建一条记录</span></div><div class="line">    ABRecordRef recordRef= ABPersonCreate();</div><div class="line">    ABRecordSetValue(recordRef, kABPersonFirstNameProperty, (__bridge <span class="built_in">CFTypeRef</span>)(firstName), <span class="literal">NULL</span>);<span class="comment">//添加名</span></div><div class="line">    ABRecordSetValue(recordRef, kABPersonLastNameProperty, (__bridge <span class="built_in">CFTypeRef</span>)(lastName), <span class="literal">NULL</span>);<span class="comment">//添加姓</span></div><div class="line">    </div><div class="line">    ABMutableMultiValueRef multiValueRef =ABMultiValueCreateMutable(kABStringPropertyType);<span class="comment">//添加设置多值属性</span></div><div class="line">    ABMultiValueAddValueAndLabel(multiValueRef, (__bridge <span class="built_in">CFStringRef</span>)(workNumber), kABWorkLabel, <span class="literal">NULL</span>);<span class="comment">//添加工作电话</span></div><div class="line">    ABRecordSetValue(recordRef, kABPersonPhoneProperty, multiValueRef, <span class="literal">NULL</span>);</div><div class="line">    </div><div class="line">    <span class="comment">//添加记录</span></div><div class="line">    ABAddressBookAddRecord(<span class="keyword">self</span>.addressBook, recordRef, <span class="literal">NULL</span>);</div><div class="line">    </div><div class="line">    <span class="comment">//保存通讯录，提交更改</span></div><div class="line">    ABAddressBookSave(<span class="keyword">self</span>.addressBook, <span class="literal">NULL</span>);</div><div class="line">    <span class="comment">//释放资源</span></div><div class="line">    <span class="built_in">CFRelease</span>(recordRef);</div><div class="line">    <span class="built_in">CFRelease</span>(multiValueRef);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> *  根据RecordID修改联系人信息</div><div class="line"> *</div><div class="line"> *  @param recordID   记录唯一ID</div><div class="line"> *  @param firstName  姓</div><div class="line"> *  @param lastName   名</div><div class="line"> *  @param homeNumber 工作电话</div><div class="line"> */</div><div class="line">-(<span class="keyword">void</span>)modifyPersonWithRecordID:(ABRecordID)recordID firstName:(<span class="built_in">NSString</span> *)firstName lastName:(<span class="built_in">NSString</span> *)lastName workNumber:(<span class="built_in">NSString</span> *)workNumber&#123;</div><div class="line">    ABRecordRef recordRef=ABAddressBookGetPersonWithRecordID(<span class="keyword">self</span>.addressBook,recordID);</div><div class="line">    ABRecordSetValue(recordRef, kABPersonFirstNameProperty, (__bridge <span class="built_in">CFTypeRef</span>)(firstName), <span class="literal">NULL</span>);<span class="comment">//添加名</span></div><div class="line">    ABRecordSetValue(recordRef, kABPersonLastNameProperty, (__bridge <span class="built_in">CFTypeRef</span>)(lastName), <span class="literal">NULL</span>);<span class="comment">//添加姓</span></div><div class="line">    </div><div class="line">    ABMutableMultiValueRef multiValueRef =ABMultiValueCreateMutable(kABStringPropertyType);</div><div class="line">    ABMultiValueAddValueAndLabel(multiValueRef, (__bridge <span class="built_in">CFStringRef</span>)(workNumber), kABWorkLabel, <span class="literal">NULL</span>);</div><div class="line">    ABRecordSetValue(recordRef, kABPersonPhoneProperty, multiValueRef, <span class="literal">NULL</span>);</div><div class="line">    <span class="comment">//保存记录，提交更改</span></div><div class="line">    ABAddressBookSave(<span class="keyword">self</span>.addressBook, <span class="literal">NULL</span>);</div><div class="line">    <span class="comment">//释放资源</span></div><div class="line">    <span class="built_in">CFRelease</span>(multiValueRef);</div><div class="line">&#125;</div><div class="line"><span class="keyword">@end</span></div><div class="line">新增或修改控制器视图，用于显示一个联系人的信息或者新增一个联系人：</div><div class="line">KCAddPersonViewController.h</div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">//  KCAddPersonViewController.h</span></div><div class="line"><span class="comment">//  AddressBook</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">//  kABPersonFirstNameProperty</span></div><div class="line"><span class="comment">//  Copyright (c) 2014年 cmjstudio. All rights reserved.</span></div><div class="line"><span class="comment">//</span></div><div class="line"></div><div class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></div><div class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">KCContactDelegate</span>;</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">KCAddPersonViewController</span> : <span class="title">UIViewController</span></span></div><div class="line"></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">assign</span>,<span class="keyword">nonatomic</span>) <span class="keyword">int</span> recordID;<span class="comment">//通讯录记录id，如果ID不为0则代表修改否则认为是新增</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>,<span class="keyword">nonatomic</span>) <span class="built_in">NSString</span> *firstNameText;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>,<span class="keyword">nonatomic</span>) <span class="built_in">NSString</span> *lastNameText;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>,<span class="keyword">nonatomic</span>) <span class="built_in">NSString</span> *workPhoneText;</div><div class="line"></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>,<span class="keyword">nonatomic</span>) <span class="keyword">id</span>&lt;KCContactDelegate&gt; delegate;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div><div class="line">KCAddPersonViewController.m</div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">//  KCAddPersonViewController.m</span></div><div class="line"><span class="comment">//  AddressBook</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">//  kABPersonFirstNameProperty</span></div><div class="line"><span class="comment">//  Copyright (c) 2014年 cmjstudio. All rights reserved.</span></div><div class="line"><span class="comment">//</span></div><div class="line"></div><div class="line"><span class="meta">#import <span class="meta-string">"KCAddPersonViewController.h"</span></span></div><div class="line"><span class="meta">#import <span class="meta-string">"KCContactTableViewController.h"</span></span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">KCAddPersonViewController</span> ()</span></div><div class="line"></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UITextField</span> *firstName;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UITextField</span> *lastName;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UITextField</span> *workPhone;</div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">KCAddPersonViewController</span></span></div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</div><div class="line">    [<span class="keyword">super</span> viewDidLoad];</div><div class="line">    [<span class="keyword">self</span> setupUI];</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">#pragma mark - UI事件</span></div><div class="line">- (<span class="keyword">IBAction</span>)cancelClick:(<span class="built_in">UIBarButtonItem</span> *)sender &#123;</div><div class="line">    [<span class="keyword">self</span>.delegate cancelEdit];</div><div class="line">    [<span class="keyword">self</span> dismissViewControllerAnimated:<span class="literal">YES</span> completion:<span class="literal">nil</span>];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">IBAction</span>)doneClick:(<span class="built_in">UIBarButtonItem</span> *)sender &#123;</div><div class="line">    <span class="comment">//调用代理方法</span></div><div class="line">    [<span class="keyword">self</span>.delegate editPersonWithFirstName:<span class="keyword">self</span>.firstName.text lastName:<span class="keyword">self</span>.lastName.text workNumber:<span class="keyword">self</span>.workPhone.text];</div><div class="line">    </div><div class="line">    [<span class="keyword">self</span> dismissViewControllerAnimated:<span class="literal">YES</span> completion:<span class="literal">nil</span>];</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">#pragma mark - 私有方法</span></div><div class="line">-(<span class="keyword">void</span>)setupUI&#123;</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.recordID) &#123;<span class="comment">//如果ID不为0则认为是修改，此时需要初始化界面</span></div><div class="line">        <span class="keyword">self</span>.firstName.text=<span class="keyword">self</span>.firstNameText;</div><div class="line">        <span class="keyword">self</span>.lastName.text=<span class="keyword">self</span>.lastNameText;</div><div class="line">        <span class="keyword">self</span>.workPhone.text=<span class="keyword">self</span>.workPhoneText;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/objective-c/">objective-c</a>
    </div>


      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-view 的 clipsToBounds属性" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/10/08/view 的 clipsToBounds属性/" class="article-date">
      <time datetime="2016-10-08T03:39:43.000Z" itemprop="datePublished">2016-10-08</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/10/08/view 的 clipsToBounds属性/">view 的 clipsToBounds属性</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <a id="more"></a>
<p><strong>取值：</strong>BOOL（YES/NO）<strong>作用：</strong>决定了子视图的显示范围当取值为YES时，超出父视图范围的子视图被剪裁不显示；当取值为NO时，超出父视图范围的子视图不被剪裁，显示。默认值为NO。<br>如下图所示：view2是view1的子视图<br><strong>取值为NO时：</strong><br><strong>取值为YES时：</strong><img src="http://img.blog.csdn.net/20160525095602290?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""><br><img src="http://img.blog.csdn.net/20160525095512445?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/objective-c/">objective-c</a>
    </div>


      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-MPMoviePlayerViewController和MPMoviePlayerController" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/10/08/MPMoviePlayerViewController和MPMoviePlayerController/" class="article-date">
      <time datetime="2016-10-08T03:39:43.000Z" itemprop="datePublished">2016-10-08</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/10/08/MPMoviePlayerViewController和MPMoviePlayerController/">MPMoviePlayerViewController和MPMoviePlayerController</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <a id="more"></a>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</div><div class="line">    [<span class="keyword">super</span> viewDidLoad];</div><div class="line"></div><div class="line">    [<span class="keyword">self</span> playVideo:[<span class="built_in">NSURL</span> URLWithString:<span class="keyword">self</span>.playURL]];</div><div class="line"></div><div class="line">&#125;</div><div class="line"><span class="comment">//根据视频url播放视频</span></div><div class="line">- (<span class="keyword">void</span>) playVideo:(<span class="built_in">NSURL</span> *) movieURL</div><div class="line">&#123;</div><div class="line">    <span class="built_in">MPMoviePlayerViewController</span> *playerViewController = [[<span class="built_in">MPMoviePlayerViewController</span> alloc]     initWithContentURL:movieURL];</div><div class="line">    <span class="keyword">self</span>.playerViewController = playerViewController;</div><div class="line">    [[<span class="built_in">NSNotificationCenter</span> defaultCenter] addObserver:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(playVideoFinished:) name:<span class="built_in">MPMoviePlayerPlaybackDidFinishNotification</span> object:[playerViewController moviePlayer]];</div><div class="line">    playerViewController.modalTransitionStyle = <span class="built_in">UIModalTransitionStyleFlipHorizontal</span>;</div><div class="line">    [<span class="keyword">self</span>.view addSubview:playerViewController.view];</div><div class="line">    <span class="built_in">MPMoviePlayerController</span> *player = [playerViewController moviePlayer];</div><div class="line">    [player play];</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//当点击Done按键或者播放完毕时调用此函数</span></div><div class="line">- (<span class="keyword">void</span>) playVideoFinished:(<span class="built_in">NSNotification</span> *)theNotification</div><div class="line">&#123;</div><div class="line">    <span class="built_in">MPMoviePlayerController</span> *player = [theNotification object];</div><div class="line">    [[<span class="built_in">NSNotificationCenter</span> defaultCenter] removeObserver:<span class="keyword">self</span> name:<span class="built_in">MPMoviePlayerPlaybackDidFinishNotification</span> object:player];</div><div class="line">    [player stop];</div><div class="line"></div><div class="line">    [<span class="keyword">self</span> dismissViewControllerAnimated:<span class="literal">YES</span> completion:^&#123;</div><div class="line">       </div><div class="line">       </div><div class="line">    &#125;];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>MPMoviePlayerViewController和MPMoviePlayerController 使用场合不一样MPMoviePlayerViewController是在iOS3.2以后的平台上使用。MPMoviePlayerController在3.2之前使用，虽然在3.2之后也能使用，但是使用方法略有改变，建议3.2之后使用MPMoviePlayerViewController。<br>3.2之后,MPMoviePlayerController作为MPMoviePlayerViewController的一个属性存在。</p>
<p>以下是使用MPMoviePlayerViewController播放视频的代码:</p>
<p>去掉系统上的按钮导航条 self.play.controlStyle = MPMovieControlStyleNone;</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/objective-c/">objective-c</a>
    </div>


      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-不同数据类型转换" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/10/08/不同数据类型转换/" class="article-date">
      <time datetime="2016-10-08T03:39:43.000Z" itemprop="datePublished">2016-10-08</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/10/08/不同数据类型转换/">不同数据类型转换</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
              <p>不同数据类型转换<br>
          
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/objective-c/">objective-c</a>
    </div>


      
      
        <p class="article-more-link">
          <a href="/2016/10/08/不同数据类型转换/#more">查看全文 >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-删除Xcode插件" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/10/08/删除Xcode插件/" class="article-date">
      <time datetime="2016-10-08T03:39:43.000Z" itemprop="datePublished">2016-10-08</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/10/08/删除Xcode插件/">删除Xcode插件</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <a id="more"></a>
<pre><code>直接进入插件所在的目录，将插件删除即可。
</code></pre><p>插件路径为：~/Library/Application Support/Developer/Shared/Xcode/Plug-ins    Library文件夹（即资源库）默认是隐藏的，所以你可以使用一下方法打开该路径：</p>
<p>Finder 前往-&gt;前往文件夹(快捷键cmd+Shift+G)，输入以上路径，回车，找到Fuzzy Aotocomplete插件，删除。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/objective-c/">objective-c</a>
    </div>


      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Masonry介绍与使用实践：快速上手Autolayout" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/10/08/Masonry介绍与使用实践：快速上手Autolayout/" class="article-date">
      <time datetime="2016-10-08T03:39:43.000Z" itemprop="datePublished">2016-10-08</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/10/08/Masonry介绍与使用实践：快速上手Autolayout/">Masonry介绍与使用实践：快速上手Autolayout</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <a id="more"></a>
<p>转自：<a href="http://www.cocoachina.com/ios/20141219/10702.html" target="_blank" rel="external">http://www.cocoachina.com/ios/20141219/10702.html</a><br>前言<br>    MagicNumber -&gt; autoresizingMask -&gt; autolayou<br>以上是纯手写代码所经历的关于页面布局的三个时期<br>在iphone1-iphone3gs时代 window的size固定为(320,480) 我们只需要简单计算一下相对位置就好了<br>在iphone4-iphone4s时代 苹果推出了retina屏 但是给了码农们非常大的福利:window的size不变<br>在iphone5-iphone5s时代 window的size变了(320,568) 这时autoresizingMask派上了用场(为啥这时候不用Autolayout? 因为还要支持ios5呗) 简单的适配一下即可<br>在iphone6+时代 window的width也发生了变化(相对5和5s的屏幕比例没有变化) 终于是时候抛弃autoresizingMask改用autolayout了(不用支持ios5了 相对于屏幕适配的多样性来说autoresizingMask也已经过时了)<br>那如何快速的上手autolayout呢? 说实话 当年ios6推出的同时新增了autolayout的特性 我看了一下官方文档和demo 就立马抛弃到一边了 因为实在过于的繁琐和啰嗦(有过经验的朋友肯定有同感)<br>直到iPhone6发布之后 我知道使用autolayout势在必行了 这时想起了以前在浏览Github看到过的一个第三方库Masonry 在花了几个小时的研究使用后 我就将autolayout掌握了(重点是我并没有学习任何的官方文档或者其他的关于autolayout的知识) 这就是我为什么要写下这篇文章来推荐它的原因.<br><strong>介绍</strong><br>Masonry 源码：<a href="https://github.com/Masonry/Masonry" target="_blank" rel="external">https://github.com/Masonry/Masonry</a><br>Masonry是一个轻量级的布局框架 拥有自己的描述语法 采用更优雅的链式语法封装自动布局 简洁明了 并具有高可读性 而且同时支持 iOS 和 Max OS X。<br>我们先来看一段官方的sample code来认识一下Masonry<br>    [view1 mas_makeConstraints:^(MASConstraintMaker <em>make) {<br>        make.edges.equalTo(superview).with.insets(padding);<br>    }];<br>看到block里面的那句话: make edges equalTo superview with insets<br>通过链式的自然语言 就把view1给autolayout好了 是不是简单易懂?<br><strong>使用</strong><br>看一下Masonry支持哪一些属性<br>    @property (nonatomic, strong, readonly) MASConstraint </em>left;<br>    @property (nonatomic, strong, readonly) MASConstraint <em>top;<br>    @property (nonatomic, strong, readonly) MASConstraint </em>right;<br>    @property (nonatomic, strong, readonly) MASConstraint <em>bottom;<br>    @property (nonatomic, strong, readonly) MASConstraint </em>leading;<br>    @property (nonatomic, strong, readonly) MASConstraint <em>trailing;<br>    @property (nonatomic, strong, readonly) MASConstraint </em>width;<br>    @property (nonatomic, strong, readonly) MASConstraint <em>height;<br>    @property (nonatomic, strong, readonly) MASConstraint </em>centerX;<br>    @property (nonatomic, strong, readonly) MASConstraint <em>centerY;<br>    @property (nonatomic, strong, readonly) MASConstraint </em>baseline;<br>这些属性与NSLayoutAttrubute的对照表如下</p>
<p>其中leading与left trailing与right 在正常情况下是等价的 但是当一些布局是从右至左时(比如阿拉伯文?没有类似的经验) 则会对调 换句话说就是基本可以不理不用 用left和right就好了<br>在ios8发布后 又新增了一堆奇奇怪怪的属性(有兴趣的朋友可以去瞅瞅) Masonry暂时还不支持(不过你要支持ios6,ios7 就没必要去管那么多了)<br>在讲实例之前 先介绍一个MACRO<br>1<code>#define WS(weakSelf)  __weak __typeof(&amp;*self)weakSelf = self;</code>快速的定义一个weakSelf 当然是用于block里面啦 下面进入正题(为了方便 我们测试的superView都是一个size为(300,300)的UIView)<br>下面 通过一些简单的实例来简单介绍如何轻松愉快的使用Masonry:</p>
<ol>
<li>[基础] 居中显示一个view<br>1234567891011121314151617<code>- (void)viewDidLoad``{``    ``[``super</code> <code>viewDidLoad];``    ``// Do any additional setup after loading the view.`` </code> <code>``WS(ws);`` </code> <code>``UIView *sv = [UIView ``new``];``    ``[sv showPlaceHolder];``    ``sv.backgroundColor = [UIColor blackColor];``    ``[self.view addSubview:sv];``    ``[sv mas_makeConstraints:^(MASConstraintMaker *make) {``        ``make.center.equalTo(ws.view);``        ``make.size.mas_equalTo(CGSizeMake(300, 300));``    ``}];`` </code> <code>}</code></li>
</ol>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/objective-c/">objective-c</a>
    </div>


      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-不规则瀑布流" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/10/08/不规则瀑布流/" class="article-date">
      <time datetime="2016-10-08T03:39:43.000Z" itemprop="datePublished">2016-10-08</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/10/08/不规则瀑布流/">不规则瀑布流</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <a id="more"></a>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></div><div class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></div><div class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">WaterLayoutDelegate</span> &lt;<span class="title">NSObject</span>&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">@required</span></div><div class="line">- (<span class="built_in">CGSize</span>)collectionView:(<span class="built_in">UICollectionView</span> *)collectionView</div><div class="line">                  layout:(<span class="built_in">UICollectionViewLayout</span> *)collectionViewLayout</div><div class="line">  sizeForItemAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">@end</span></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">WJY_WaterFallLayout</span> : <span class="title">UICollectionViewLayout</span></span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="keyword">id</span>&lt;WaterLayoutDelegate&gt; delegate;</div><div class="line"><span class="comment">// 行数</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">NSInteger</span> lineCount;</div><div class="line"><span class="comment">// 水平间距</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">CGFloat</span> verticalSpacing;</div><div class="line"><span class="comment">// 垂直间距</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">CGFloat</span> horizontalSpacing;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">UIEdgeInsets</span> sectionInset;</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#import <span class="meta-string">"WJY_WaterFallLayout.h"</span></span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">WJY_WaterFallLayout</span>()</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">retain</span>) <span class="built_in">NSMutableArray</span> *heights;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">retain</span>) <span class="built_in">NSMutableArray</span> *originX;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">retain</span>) <span class="built_in">NSMutableDictionary</span> *itemsArrange;</div><div class="line"></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">retain</span>) <span class="built_in">NSMutableDictionary</span> *itemsInitialArrange;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">WJY_WaterFallLayout</span></span></div><div class="line"><span class="meta">#pragma mark - 重写，应 始终调用子类</span></div><div class="line">- (<span class="keyword">void</span>)prepareLayout</div><div class="line">&#123;</div><div class="line">    <span class="comment">// 如果item 是0 返回</span></div><div class="line">    <span class="built_in">NSInteger</span> cellCount = [<span class="keyword">self</span>.collectionView numberOfItemsInSection:<span class="number">0</span>];</div><div class="line">    <span class="keyword">if</span> (cellCount == <span class="number">0</span>) &#123;</div><div class="line">        <span class="keyword">return</span> ;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// 调转系统的协议方法 并设置代理</span></div><div class="line">    <span class="keyword">self</span>.delegate = (<span class="keyword">id</span>&lt;WaterLayoutDelegate&gt;)<span class="keyword">self</span>.collectionView.delegate;</div><div class="line">    </div><div class="line">    <span class="keyword">self</span>.itemsArrange = [<span class="built_in">NSMutableDictionary</span> dictionary];</div><div class="line">    <span class="keyword">self</span>.itemsInitialArrange = [<span class="built_in">NSMutableDictionary</span> dictionary];</div><div class="line">    </div><div class="line">    [<span class="keyword">self</span> initAllarrays];</div><div class="line"></div><div class="line">    <span class="keyword">for</span> (<span class="built_in">NSInteger</span> i = <span class="number">0</span>; i &lt; cellCount; i++) &#123;</div><div class="line">        [</div><div class="line">         <span class="keyword">self</span> layoutForItemAtIndexPath:[<span class="built_in">NSIndexPath</span> indexPathForItem:i inSection:<span class="number">0</span>]];</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line"><span class="meta">#pragma 初始化所以数组</span></div><div class="line">- (<span class="keyword">void</span>)initAllarrays</div><div class="line">&#123;</div><div class="line">    </div><div class="line">    <span class="keyword">self</span>.heights = [<span class="built_in">NSMutableArray</span> array];</div><div class="line">    <span class="keyword">self</span>.originX = [<span class="built_in">NSMutableArray</span> array];</div><div class="line">    <span class="comment">// item宽度</span></div><div class="line">    <span class="built_in">CGFloat</span> itemWidth   = ([<span class="built_in">UIScreen</span> mainScreen].bounds.size.width - <span class="keyword">self</span>.sectionInset.left - <span class="keyword">self</span>.sectionInset.right - (<span class="keyword">self</span>.lineCount - <span class="number">1</span>) * <span class="keyword">self</span>.horizontalSpacing) / <span class="keyword">self</span>.lineCount;</div><div class="line">    </div><div class="line">    <span class="keyword">for</span> (<span class="built_in">NSInteger</span> i = <span class="number">0</span>; i &lt; <span class="keyword">self</span>.lineCount; i++) &#123;</div><div class="line">        </div><div class="line">        <span class="comment">// 循环添加 每行的每个top的点到 height数组中</span></div><div class="line">        [<span class="keyword">self</span>.heights addObject:[<span class="built_in">NSNumber</span> numberWithDouble:<span class="keyword">self</span>.sectionInset.top]];</div><div class="line">        </div><div class="line">        <span class="comment">//设置oringin_x 为0</span></div><div class="line">        <span class="built_in">CGFloat</span> oringin_x   = <span class="number">0.0</span>;</div><div class="line">        </div><div class="line">        <span class="keyword">if</span> (i == <span class="number">0</span>) &#123;</div><div class="line">         <span class="comment">//i = 0 x点 = left;</span></div><div class="line">            oringin_x = <span class="keyword">self</span>.sectionInset.left;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="comment">//  x = i + item宽 + 横向宽度</span></div><div class="line">            oringin_x = [<span class="keyword">self</span>.originX[i - <span class="number">1</span>] doubleValue] + itemWidth + <span class="keyword">self</span>.horizontalSpacing;</div><div class="line">        &#125;</div><div class="line">         <span class="comment">// 把得到的点加到 x数组中</span></div><div class="line">        [<span class="keyword">self</span>.originX addObject:[<span class="built_in">NSNumber</span> numberWithDouble: oringin_x]];</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line"><span class="meta">#pragma mark - itme设置</span></div><div class="line">- (<span class="keyword">void</span>)layoutForItemAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath</div><div class="line">&#123;</div><div class="line">    </div><div class="line">    <span class="built_in">CGRect</span> rect = <span class="built_in">CGRectZero</span>;</div><div class="line">    <span class="comment">// 协议方法</span></div><div class="line">    <span class="built_in">CGSize</span> size = [<span class="keyword">self</span>.delegate collectionView:<span class="keyword">self</span>.collectionView layout:<span class="keyword">self</span> sizeForItemAtIndexPath:indexPath];</div><div class="line">    </div><div class="line">    rect.size.height = size.height;</div><div class="line">    </div><div class="line">    rect.size.width  = ([<span class="built_in">UIScreen</span> mainScreen].bounds.size.width  - <span class="keyword">self</span>.sectionInset.left - <span class="keyword">self</span>.sectionInset.right - (<span class="keyword">self</span>.lineCount - <span class="number">1</span>) * <span class="keyword">self</span>.horizontalSpacing) / <span class="keyword">self</span>.lineCount;</div><div class="line">    </div><div class="line">    <span class="built_in">NSInteger</span> index  = [<span class="keyword">self</span> getLowerHeightRowIndex:<span class="keyword">self</span>.heights];</div><div class="line">    </div><div class="line">    rect.origin.x = [<span class="keyword">self</span>.originX[index] doubleValue];</div><div class="line">    rect.origin.y = [<span class="keyword">self</span>.heights[index] doubleValue];</div><div class="line">    </div><div class="line">    <span class="built_in">CGFloat</span> newHeight = rect.origin.y + rect.size.height + <span class="keyword">self</span>.verticalSpacing;</div><div class="line">    </div><div class="line">    [<span class="keyword">self</span>.heights replaceObjectAtIndex:index withObject:[<span class="built_in">NSNumber</span> numberWithDouble: newHeight]];</div><div class="line">    </div><div class="line">    [<span class="keyword">self</span>.itemsArrange setObject:indexPath forKey:<span class="built_in">NSStringFromCGRect</span>(rect)];</div><div class="line">    </div><div class="line">    [<span class="keyword">self</span>.itemsInitialArrange setObject:indexPath forKey:<span class="built_in">NSStringFromCGRect</span>(<span class="built_in">CGRectMake</span>(rect.origin.x, rect.origin.y - [<span class="built_in">UIScreen</span> mainScreen].bounds.size.height, rect.size.width, rect.size.height))];</div><div class="line">&#125;</div><div class="line"><span class="meta">#pragma mark - 子类必须重写此方法并使用它来返回的宽度和高度的视图的内容。这些值表示的宽度和高度的所有内容，视图使用此信息来配置其自身内容的大小，以便滚动。</span></div><div class="line">- (<span class="built_in">CGSize</span>)collectionViewContentSize</div><div class="line">&#123;</div><div class="line">    </div><div class="line">    </div><div class="line">    <span class="built_in">CGFloat</span> heightest = [<span class="keyword">self</span> getHeightest:<span class="keyword">self</span>.heights];</div><div class="line">    </div><div class="line">    <span class="built_in">CGSize</span> size = <span class="built_in">CGSizeMake</span>(<span class="number">0</span>, heightest);</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> size;</div><div class="line">&#125;</div><div class="line"><span class="meta">#pragma mark - 设置布局信息</span></div><div class="line">- (<span class="built_in">UICollectionViewLayoutAttributes</span> *)layoutAttributesForItemAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath &#123;</div><div class="line">    </div><div class="line">    <span class="built_in">UICollectionViewLayoutAttributes</span> *attributes = [<span class="built_in">UICollectionViewLayoutAttributes</span> layoutAttributesForCellWithIndexPath:indexPath];</div><div class="line">    </div><div class="line">    <span class="built_in">NSArray</span> *keyArr = <span class="keyword">self</span>.itemsArrange.allKeys;</div><div class="line">    </div><div class="line">    <span class="keyword">for</span> (<span class="built_in">NSString</span> *rectStr <span class="keyword">in</span> keyArr) &#123;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (<span class="keyword">self</span>.itemsArrange[rectStr] != indexPath) &#123;</div><div class="line">            <span class="keyword">continue</span>;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="built_in">CGRect</span> rect = <span class="built_in">CGRectFromString</span>(rectStr);</div><div class="line">        </div><div class="line">        attributes.frame = rect;</div><div class="line">        </div><div class="line">        <span class="keyword">break</span>;</div><div class="line">        </div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> attributes;</div><div class="line">&#125;</div><div class="line"><span class="meta">#pragma mark - 重新自定义layout</span></div><div class="line">- (<span class="built_in">UICollectionViewLayoutAttributes</span> *)initialLayoutAttributesForAppearingItemAtIndexPath:(<span class="built_in">NSIndexPath</span> *)itemIndexPath &#123;</div><div class="line">    <span class="comment">// layout初始化方法</span></div><div class="line">    <span class="built_in">UICollectionViewLayoutAttributes</span> *attributes = [<span class="built_in">UICollectionViewLayoutAttributes</span> layoutAttributesForCellWithIndexPath:itemIndexPath];</div><div class="line">    </div><div class="line">    <span class="built_in">NSArray</span> *keyArr = <span class="keyword">self</span>.itemsArrange.allKeys;</div><div class="line">    </div><div class="line">    <span class="keyword">for</span> (<span class="built_in">NSString</span> *rectStr <span class="keyword">in</span> keyArr) &#123;</div><div class="line">        <span class="comment">// item的rect信息和布局信息不等 就跳出本次循环</span></div><div class="line">        <span class="keyword">if</span> (<span class="keyword">self</span>.itemsInitialArrange[rectStr] != itemIndexPath) &#123;</div><div class="line">            <span class="keyword">continue</span>;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="built_in">CGRect</span> rect = <span class="built_in">CGRectFromString</span>(rectStr);</div><div class="line">        </div><div class="line">        attributes.frame = rect;</div><div class="line">        </div><div class="line">        <span class="keyword">break</span>;</div><div class="line">        </div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> attributes;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">#pragma mark - 布局属性返回数组 视图在给定矩形</span></div><div class="line">- (<span class="built_in">NSArray</span> *)layoutAttributesForElementsInRect:(<span class="built_in">CGRect</span>)rect &#123;</div><div class="line">    </div><div class="line">    <span class="built_in">CGFloat</span> up = rect.origin.y;</div><div class="line">    </div><div class="line">    <span class="built_in">CGFloat</span> down = rect.origin.y + rect.size.height;</div><div class="line">    </div><div class="line">    <span class="built_in">NSMutableArray</span> *attributes = [<span class="built_in">NSMutableArray</span> array];</div><div class="line">    </div><div class="line">    <span class="keyword">for</span> (<span class="built_in">NSString</span> *rectStr <span class="keyword">in</span> <span class="keyword">self</span>.itemsArrange) &#123;</div><div class="line">        </div><div class="line">        <span class="built_in">CGRect</span> itemRect = <span class="built_in">CGRectFromString</span>(rectStr);</div><div class="line">        </div><div class="line">        <span class="keyword">if</span> (itemRect.origin.y &lt;= down &amp;&amp; itemRect.origin.y + itemRect.size.height &gt;= up) &#123;</div><div class="line">            </div><div class="line">            <span class="built_in">NSIndexPath</span> *indexPath = [<span class="keyword">self</span>.itemsArrange objectForKey:rectStr];</div><div class="line">            </div><div class="line">                    <span class="comment">//设置布局信息 添加到数组里</span></div><div class="line">            [attributes addObject:[<span class="keyword">self</span> layoutAttributesForItemAtIndexPath:indexPath]];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> attributes;</div><div class="line">&#125;</div><div class="line"><span class="meta"># pragma mark - 获取低行高</span></div><div class="line">- (<span class="built_in">NSInteger</span>)getLowerHeightRowIndex:(<span class="built_in">NSMutableArray</span> *)height &#123;</div><div class="line">    </div><div class="line">    <span class="keyword">if</span> (height.count == <span class="number">0</span>) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="built_in">NSInteger</span> index  = <span class="number">0</span>;</div><div class="line">    </div><div class="line">    <span class="built_in">CGFloat</span> heightest = [height[<span class="number">0</span>] doubleValue];</div><div class="line">    </div><div class="line">    <span class="keyword">for</span> (<span class="built_in">NSInteger</span> i  = <span class="number">1</span>; i &lt; height.count; i++) &#123;</div><div class="line">        <span class="comment">// 判定获取低行位置</span></div><div class="line">        index = heightest &gt; [height[i] doubleValue] ? i : index;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> index;</div><div class="line">&#125;</div><div class="line"><span class="meta"># pragma mark - 获取高度</span></div><div class="line">- (<span class="built_in">CGFloat</span>)getHeightest:(<span class="built_in">NSMutableArray</span> *)height &#123;</div><div class="line">    </div><div class="line">    <span class="keyword">if</span> (height.count == <span class="number">0</span>) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="built_in">CGFloat</span> heightest = <span class="keyword">self</span>.sectionInset.top;</div><div class="line">    <span class="comment">// 遍历最高点</span></div><div class="line">    <span class="keyword">for</span> (<span class="built_in">NSInteger</span> i  = <span class="number">0</span>; i &lt; height.count; i++) &#123;</div><div class="line">        <span class="comment">// 如果heightest为最高点返回返回 如果不是则返回height</span></div><div class="line">        heightest  = heightest &gt; [height[i] doubleValue] ? heightest : [height[i] doubleValue];</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> heightest;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/objective-c/">objective-c</a>
    </div>


      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/11/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><a class="page-number" href="/page/11/">11</a><span class="page-number current">12</span><a class="page-number" href="/page/13/">13</a><a class="page-number" href="/page/14/">14</a><a class="page-number" href="/page/15/">15</a><a class="extend next" rel="next" href="/page/13/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <i class="fa fa-copyright"></i> 
                2015-2017 Shirly
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" title="本站到訪數"><i class="fa fa-user" aria-hidden="true"></i><span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>| </span>
                
                
                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit"  title="本頁閱讀量"><i class="fa fa-eye animated infinite pulse" aria-hidden="true"></i><span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>
    </div>
    
<script data-main="/js/main.js" src="//cdn.bootcss.com/require.js/2.2.0/require.min.js"></script>

    <script>
        $(document).ready(function() {
            var iPad = window.navigator.userAgent.indexOf('iPad');
            if (iPad > -1 || $(".left-col").css("display") === "none") {
                var bgColorList = ["#9db3f4", "#414141", "#e5a859", "#f5dfc6", "#c084a0", "#847e72", "#cd8390", "#996731"];
                var bgColor = Math.ceil(Math.random() * (bgColorList.length - 1));
                $("body").css({"background-color": bgColorList[bgColor], "background-size": "cover"});
            }
            else {
                var backgroundnum = 5;
                var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
                $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
            }
        })
    </script>





<div class="scroll" id="scroll">
    <a href="#" title="返回頂部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" onclick="load$hide();" title="查看評論"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="轉到底部"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    // Open in New Window
    
        var oOpenInNew = {
            
            
            
            
            
            
             archives: ".archive-article-title", 
             miniArchives: "a.post-list-link", 
            
             friends: "#js-friends a", 
             socail: ".social a" 
        }
        for (var x in oOpenInNew) {
            $(oOpenInNew[x]).attr("target", "_blank");
        }
    
</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div>
</body>
</html>